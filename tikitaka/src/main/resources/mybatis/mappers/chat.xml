<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="chat">
<!-- useGeneratedKeys = "true"(기본값 false), keyColumn = [PK 컬럼명], keyProperty = [매핑할 변수명] -->
	<insert id="insert" parameterType="chat" useGeneratedKeys="true" 
			keyProperty="no">
		<![CDATA[
			insert into chat

			values(null,#{title},#{contents},#{join_count},now(), "group")

		]]>
	</insert>

	<select id="SearchByChatNo" resultType="String">
		<![CDATA[
		  	select ifnull(( select a.no from tikitaka.chat a 
			join (select d.no from tikitaka.chat d join tikitaka.chat_member e on d.no = e.chat_no where e.user_no = #{userNo}) b
			on b.no = a.no join (select f.no from tikitaka.chat f join tikitaka.chat_member g on f.no = g.chat_no where g.user_no = #{authNo}) c
			on  c.no = b.no), '0');
		]]>	
	</select>
</mapper>
